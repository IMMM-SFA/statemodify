
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>statemodify Quickstarter Notebook #2 : Using the EVA Modification Function in the Gunnison River Basin &#8212; statemodify documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=f6d3da1f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=a5fa425f"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/N2_Evaporation_File_Modification';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_statemodify.png" class="logo__image only-light" alt="statemodify documentation - Home"/>
    <script>document.write(`<img src="../_static/logo_statemodify.png" class="logo__image only-dark" alt="statemodify documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/quickstarter.html">Quickstarter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/useful_links.html">Useful Links</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">Python API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing to <strong>statemodify</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/IMMM-SFA/statemodify" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/IMMM-SFA/statemodify/edit/main/docs/source/notebooks/N2_Evaporation_File_Modification.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/IMMM-SFA/statemodify/issues/new?title=Issue%20on%20page%20%2Fnotebooks/N2_Evaporation_File_Modification.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/N2_Evaporation_File_Modification.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>statemodify Quickstarter Notebook #2 : Using the EVA Modification Function in the Gunnison River Basin</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-run-a-historical-simulation-in-statemod-for-the-gunnison-subbasin">Step 1: Run a Historical Simulation in StateMod for the Gunnison Subbasin</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-modify-statemod-input-files-for-exploratory-analyses-evaporation-function-example">Step 2: Modify StateMod Input Files for Exploratory Analyses- Evaporation Function Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-read-in-the-new-input-files-and-run-statemod-evaporation-example">Step 3: Read in the New Input Files and Run StateMod : Evaporation Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-visualize-reservoir-levels-in-new-sows">Step 4: Visualize Reservoir Levels in New SOWs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="statemodify-quickstarter-notebook-2-using-the-eva-modification-function-in-the-gunnison-river-basin">
<h1><code class="docutils literal notranslate"><span class="pre">statemodify</span></code> Quickstarter Notebook #2 : Using the EVA Modification Function in the Gunnison River Basin<a class="headerlink" href="#statemodify-quickstarter-notebook-2-using-the-eva-modification-function-in-the-gunnison-river-basin" title="Link to this heading">#</a></h1>
<p>This notebook demonstrates the reservoir evaporation modification
function using the Gunnison River Basin as an example. Reservoir
evaporation is a pressing concern in the CRB. Lake Powell loses 0.86
million acre/ft per year to evaporation, which is over 6% of the flow
into the Colorado River and nearly the allocation to the state of Utah.
With warming temperatures driving aridification in the region,
evaporation will play an increasingly important role in shortages to
users.</p>
<section id="step-1-run-a-historical-simulation-in-statemod-for-the-gunnison-subbasin">
<h2>Step 1: Run a Historical Simulation in StateMod for the Gunnison Subbasin<a class="headerlink" href="#step-1-run-a-historical-simulation-in-statemod-for-the-gunnison-subbasin" title="Link to this heading">#</a></h2>
<p>To explore the importance of evaporation, we first we run baseline
simulation as we did in the first notebook, but this time, using the
dataset for the Gunnison.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import argparse
import logging
import os
import pickle
from string import Template
import subprocess

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import statemodify as stm
</pre></div>
</div>
<div class="alert alert-block alert-info docutils container">
<p>NOTE: Each simulation in this notebook is run for the length of the
historical period (from 1909-2013). If you want to reduce the length
of the simulation, navigate to the <code class="docutils literal notranslate"><span class="pre">.ctl</span></code> file and adjust the
<code class="docutils literal notranslate"><span class="pre">iystr</span></code> and <code class="docutils literal notranslate"><span class="pre">iyend</span></code> variables. For this notebook, this file is
located in:
<code class="docutils literal notranslate"><span class="pre">data/gm2015_StateMod_modified/gm2015_StateMod_modified/StateMod/gm2015.ctl</span></code></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># statemod directory
statemod_dir = &quot;/usr/src/statemodify/statemod_gunnison_sjd&quot;

# root directory of statemod data for the target basin
root_dir = os.path.join(statemod_dir, &quot;src&quot;, &quot;main&quot;, &quot;fortran&quot;)

# home directory of notebook instance
home_dir = os.path.dirname(os.getcwd())

# path to the statemod executable
statemod_exe = os.path.join(root_dir, &quot;statemod-17.0.3-gfortran-lin-64bit-o3&quot;)

# data directory and root name for the target basin
data_dir = os.path.join(
    home_dir,
    &quot;data&quot;,
    &quot;gm2015_StateMod_modified&quot;,
    &quot;gm2015_StateMod_modified&quot;,
    &quot;StateMod&quot;
)

# directory to the target basin input files with root name for the basin
basin_path = os.path.join(data_dir, &quot;gm2015B&quot;)

# scenarios output directory
scenarios_dir = os.path.join(data_dir, &quot;scenarios&quot;)

# path to eva template file
eva_template_file = os.path.join(
    home_dir,
    &quot;data&quot;,
    &quot;gm2015B_template_eva.rsp&quot;
)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># run statemod
subprocess.call([statemod_exe, basin_path, &quot;-simulate&quot;])
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">Startup</span> <span class="n">log</span> <span class="n">file</span> <span class="k">for</span> <span class="n">messages</span> <span class="n">to</span> <span class="n">this</span> <span class="n">point</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">StateMod</span><span class="o">/</span><span class="n">gm2015B</span><span class="o">.</span><span class="n">rsp</span>
   <span class="n">Closing</span> <span class="n">startup</span> <span class="n">log</span> <span class="n">file</span><span class="p">:</span> <span class="n">statem</span><span class="o">.</span><span class="n">log</span>
   <span class="n">Opening</span> <span class="n">dataset</span> <span class="n">log</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">StateMod</span><span class="o">/</span><span class="n">gm2015B</span><span class="o">.</span><span class="n">log</span>
<span class="n">________________________________________________________________________</span>

        <span class="n">StateMod</span>
        <span class="n">State</span> <span class="n">of</span> <span class="n">Colorado</span> <span class="o">-</span> <span class="n">Water</span> <span class="n">Supply</span> <span class="n">Planning</span> <span class="n">Model</span>

        <span class="n">Version</span><span class="p">:</span>     <span class="mf">17.0.3</span>
        <span class="n">Last</span> <span class="n">revision</span> <span class="n">date</span><span class="p">:</span> <span class="mi">2021</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">12</span>

<span class="n">________________________________________________________________________</span>

  <span class="n">Subroutine</span> <span class="n">Execut</span>
  <span class="n">Subroutine</span> <span class="n">Datinp</span>

<span class="o">...</span>

<span class="n">________________________________________________________________________</span>
  <span class="n">Execut</span><span class="p">;</span> <span class="n">Successful</span> <span class="n">Termination</span>
  <span class="n">Statem</span><span class="p">;</span> <span class="n">See</span> <span class="n">detailed</span> <span class="n">messages</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="n">log</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">StateMod</span><span class="o">/</span><span class="n">gm2015B</span><span class="o">.</span><span class="n">log</span>
 <span class="n">Stop</span> <span class="mi">0</span>
</pre></div>
</div>
<p>In this notebook, rather than acquiring user shortages which are found
in the <code class="docutils literal notranslate"><span class="pre">.xdd</span></code> output file, we can track reservoir storage which is
found in the
<code class="docutils literal notranslate"><span class="pre">`.xre</span></code> &lt;<a class="reference external" href="https://opencdss.state.co.us/statemod/latest/doc-user/OutputDescription/522/">https://opencdss.state.co.us/statemod/latest/doc-user/OutputDescription/522/</a>&gt;`__
output file. Thus, in <code class="docutils literal notranslate"><span class="pre">statemodify</span></code>, we create a method that will
allow us to extract output from the <code class="docutils literal notranslate"><span class="pre">gm2015B.xre</span></code> file and save it as
a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file. Here we extract the shortages for Blue Mesa, one of the
most important upstream reservoirs in the Gunnison that is responsible
for supplying emergency water to Lake Powell.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># create a directory to store the historical reservoir levels at Blue Mesa
output_dir = os.path.join(data_dir, &quot;historic_reservoir_levels&quot;)

if not os.path.exists(output_dir):
    os.makedirs(output_dir)

# path the the xre file
xre_file = os.path.join(data_dir, &quot;gm2015B.xre&quot;)

# structure ID for reservoir of interest
structure_ID = &#39;6203532&#39;

# name of the reservoir
structure_name = &#39;Blue_Mesa&#39;

# extract the target info into a Pandas data frame
df = stm.extract_xre_data(structure_name=structure_name,
                          structure_id=structure_ID,
                          input_file=xre_file,
                          basin_name=None,
                          output_directory=output_dir,
                          write_csv=True,
                          write_parquet=None
)
</pre></div>
</div>
<p>We can then create an annual average from our extracted monthly
reservoir storage.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>output_xre_file = os.path.join(output_dir, &quot;Blue_Mesa_xre_data.csv&quot;)

# read output data into a data frame
df = pd.read_csv(
    output_xre_file,
    usecols=[&#39;Year&#39;,&#39;Init. Storage&#39;],
    index_col=False)

# calculate the annual average
df = df.groupby(&#39;Year&#39;).mean().reset_index()

df
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Init. Storage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1908</td>
      <td>441516.500000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1909</td>
      <td>409705.807692</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1910</td>
      <td>378741.903846</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1911</td>
      <td>374242.865385</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1912</td>
      <td>402187.230769</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>101</th>
      <td>2009</td>
      <td>384270.711538</td>
    </tr>
    <tr>
      <th>102</th>
      <td>2010</td>
      <td>380057.192308</td>
    </tr>
    <tr>
      <th>103</th>
      <td>2011</td>
      <td>346074.019231</td>
    </tr>
    <tr>
      <th>104</th>
      <td>2012</td>
      <td>290796.692308</td>
    </tr>
    <tr>
      <th>105</th>
      <td>2013</td>
      <td>202086.125000</td>
    </tr>
  </tbody>
</table>
<p>106 rows × 2 columns</p>
</div><p>Finally, we can plot this annual average over time. We see swings in the
storage that correspond well with the earliest part of the streamflow
record that was relatively wet along with dry periods (large dips around
the 1930s dustbowl and 1950s drought and the severe early 2002 drought).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots()

plt.plot(df[&#39;Year&#39;], df[&#39;Init. Storage&#39;])

plt.title(&quot;Blue Mesa Storage&quot;)
plt.xlabel(&quot;Year&quot;)
plt.ylabel(&quot;Reservoir Storage (AF)&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Reservoir Storage (AF)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_13_1.png" src="../_images/output_13_1.png" />
</section>
<section id="step-2-modify-statemod-input-files-for-exploratory-analyses-evaporation-function-example">
<h2>Step 2: Modify StateMod Input Files for Exploratory Analyses- Evaporation Function Example<a class="headerlink" href="#step-2-modify-statemod-input-files-for-exploratory-analyses-evaporation-function-example" title="Link to this heading">#</a></h2>
<p>Now that we’ve run StateMod in baseline mode for the Gunnison, the next
step is to run it in exploratory analysis mode. To do this, we need to
create some plausible futures and adjust the input files for StateMod.
In this step, we’ll demonstrate Option 1 for <code class="docutils literal notranslate"><span class="pre">statemodify</span></code> adjustments
using the <code class="docutils literal notranslate"><span class="pre">gm2015.eva</span></code> file as an example. Here we apply additives
rather than multipliers. As done in Hadjimichael et al. (2020), we
sample (using LHS) the change of evaporation between -15.24 and 30.46
cm/month (-0.5 to + 1 ft). The
<code class="docutils literal notranslate"><span class="pre">`.eva</span></code> &lt;<a class="reference external" href="https://opencdss.state.co.us/statemod/latest/doc-user/InputDescription/415/">https://opencdss.state.co.us/statemod/latest/doc-user/InputDescription/415/</a>&gt;`__
file stores information for select larger reservoirs across all West
Slope basins. We choose the ID that corresponds to Blue Mesa (10011). We
create 2 alternative states of the world and store them in the
<code class="docutils literal notranslate"><span class="pre">input_files</span></code> directory.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># a dictionary to describe what you want to modify and the bounds for the Latin hypercube sample.
setup_dict = {
    &quot;ids&quot;: [&#39;10011&#39;],
    &quot;bounds&quot;: [-0.5, 1.0]
}

# create a directory to store the new files in if it does not exist
output_directory = os.path.join(data_dir, &quot;input_files&quot;)
if not os.path.exists(output_directory):
    os.makedirs(output_directory)

# scenario name
scenario = &quot;1&quot;

# the number of samples you wish to generate
n_samples = 2

# seed value for reproducibility if so desired
seed_value = 1

# number of rows to skip in file after comment
skip_rows = 1

# name of field to query
query_field = &quot;id&quot;

# number of jobs to launch in parallel; -1 is all but 1 processor used
n_jobs = -1

# basin to process
basin_name = &quot;Gunnison&quot;

# generate a batch of files using generated LHS
stm.modify_eva(modify_dict=setup_dict,
               query_field=query_field,
               output_dir=output_directory,
               scenario=scenario,
               basin_name=basin_name,
               sampling_method=&quot;LHS&quot;,
               n_samples=n_samples,
               skip_rows=skip_rows,
               n_jobs=n_jobs,
               seed_value=seed_value,
               template_file=None,
               factor_method=&quot;add&quot;,
               data_specification_file=None,
               min_bound_value=-0.5,
               max_bound_value=1.0,
               save_sample=True)
</pre></div>
</div>
<p>If we print our two samples below, we see that we’ve created a state of
the world that has reduced evaporation (subtracting 0.18 ft) and one
with increased evaporation (adding 0.79 ft). These samples will be
termed SOW 1 and SOW 2 respectively.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># path to the numpy file containing the samples
eva_samples_file = os.path.join(output_directory, &quot;eva_2-samples_scenario-1.npy&quot;)

# load samples
sample_array = np.load(eva_samples_file)

sample_array
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.1872335</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.79024337</span><span class="p">]])</span>
</pre></div>
</div>
</section>
<section id="step-3-read-in-the-new-input-files-and-run-statemod-evaporation-example">
<h2>Step 3: Read in the New Input Files and Run StateMod : Evaporation Example<a class="headerlink" href="#step-3-read-in-the-new-input-files-and-run-statemod-evaporation-example" title="Link to this heading">#</a></h2>
<p>Now that we have created the input files, the next step is to run
StateMod with the new input files. We create a template <code class="docutils literal notranslate"><span class="pre">.rsp</span></code> file
(<code class="docutils literal notranslate"><span class="pre">gm2015B_template_eva.rsp</span></code>) and swap in the path to the alternative
<code class="docutils literal notranslate"><span class="pre">.eva</span></code> files that are created. Then we run StateMod for the two
scenarios and extract the reservoir levels for Blue Mesa.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># set realization and sample
realization = 1
sample = np.arange(0, 2, 1)

# read RSP template
with open(eva_template_file) as template_obj:

    # read in file
    template_rsp = Template(template_obj.read())

    for i in sample:

        # create scenario name
        scenario = f&quot;S{i}_{realization}&quot;

        # dictionary holding search keys and replacement values to update the template file
        d = {&quot;EVA&quot;: f&quot;../../input_files/gm2015B_{scenario}.eva&quot;}

        # update the template
        new_rsp = template_rsp.safe_substitute(d)

        # construct simulated scenario directory
        simulated_scenario_dir = os.path.join(scenarios_dir, scenario)
        if not os.path.exists(simulated_scenario_dir):
            os.makedirs(simulated_scenario_dir)

        # target rsp file
        rsp_file = os.path.join(simulated_scenario_dir, f&quot;gm2015B_{scenario}.rsp&quot;)

        # write updated rsp file
        with open(rsp_file, &quot;w&quot;) as f1:
            f1.write(new_rsp)

        # construct simulated basin path
        simulated_basin_path = os.path.join(simulated_scenario_dir, f&quot;gm2015B_{scenario}&quot;)

        # run StateMod
        print(f&quot;Running: {scenario}&quot;)
        os.chdir(simulated_scenario_dir)

        subprocess.call([statemod_exe, simulated_basin_path, &quot;-simulate&quot;])
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Running</span><span class="p">:</span> <span class="n">S0_1</span>
 <span class="n">Startup</span> <span class="n">log</span> <span class="n">file</span> <span class="k">for</span> <span class="n">messages</span> <span class="n">to</span> <span class="n">this</span> <span class="n">point</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">StateMod</span><span class="o">/</span><span class="n">scenarios</span><span class="o">/</span><span class="n">S0_1</span><span class="o">/</span><span class="n">gm2015B_S0_1</span><span class="o">.</span><span class="n">rsp</span>
   <span class="n">Closing</span> <span class="n">startup</span> <span class="n">log</span> <span class="n">file</span><span class="p">:</span> <span class="n">statem</span><span class="o">.</span><span class="n">log</span>
   <span class="n">Opening</span> <span class="n">dataset</span> <span class="n">log</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">StateMod</span><span class="o">/</span><span class="n">scenarios</span><span class="o">/</span><span class="n">S0_1</span><span class="o">/</span><span class="n">gm2015B_S0_1</span><span class="o">.</span><span class="n">log</span>
<span class="n">________________________________________________________________________</span>

        <span class="n">StateMod</span>
        <span class="n">State</span> <span class="n">of</span> <span class="n">Colorado</span> <span class="o">-</span> <span class="n">Water</span> <span class="n">Supply</span> <span class="n">Planning</span> <span class="n">Model</span>

        <span class="n">Version</span><span class="p">:</span>     <span class="mf">17.0.3</span>
        <span class="n">Last</span> <span class="n">revision</span> <span class="n">date</span><span class="p">:</span> <span class="mi">2021</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">12</span>

<span class="n">________________________________________________________________________</span>

  <span class="n">Subroutine</span> <span class="n">Execut</span>
  <span class="n">Subroutine</span> <span class="n">Datinp</span>

<span class="o">...</span>

<span class="n">________________________________________________________________________</span>
  <span class="n">Execut</span><span class="p">;</span> <span class="n">Successful</span> <span class="n">Termination</span>
  <span class="n">Statem</span><span class="p">;</span> <span class="n">See</span> <span class="n">detailed</span> <span class="n">messages</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="n">log</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jovyan</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">gm2015_StateMod_modified</span><span class="o">/</span><span class="n">StateMod</span><span class="o">/</span><span class="n">scenarios</span><span class="o">/</span><span class="n">S1_1</span><span class="o">/</span><span class="n">gm2015B_S1_1</span><span class="o">.</span><span class="n">log</span>
 <span class="n">Stop</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="step-4-visualize-reservoir-levels-in-new-sows">
<h2>Step 4: Visualize Reservoir Levels in New SOWs<a class="headerlink" href="#step-4-visualize-reservoir-levels-in-new-sows" title="Link to this heading">#</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">extract_xre_data()</span></code>, we can then extract the reservoir levels
at Blue Mesa in the two new SOWs.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># SOW 1
output_dir= os.path.join(scenarios_dir, &quot;S0_1&quot;)

# path the the xre file
xre_file = os.path.join(output_dir, &quot;gm2015B_S0_1.xre&quot;)

# structure ID for reservoir of interest
structure_ID = &#39;6203532&#39;

# name of the reservoir
structure_name = &#39;Blue_Mesa&#39;

# extract the target info into a Pandas data frame
df = stm.extract_xre_data(structure_name=structure_name,
                          structure_id=structure_ID,
                          input_file=xre_file,
                          basin_name=None,
                          output_directory=output_dir,
                          write_csv=True,
                          write_parquet=None
)

# SOW 2
output_dir= os.path.join(scenarios_dir, &quot;S1_1&quot;)

# path the the xre file
xre_file = os.path.join(output_dir, &quot;gm2015B_S1_1.xre&quot;)


# extract the target info into a Pandas data frame
df = stm.extract_xre_data(structure_name=structure_name,
                          structure_id=structure_ID,
                          input_file=xre_file,
                          basin_name=None,
                          output_directory=output_dir,
                          write_csv=True,
                          write_parquet=None
)
</pre></div>
</div>
<p>Finally, we can plot reservoir storage through time in our baseline
world and alternative states of the world.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># historic reservoir directory
historic_res_dir = os.path.join(data_dir, &quot;historic_reservoir_levels&quot;)
blue_mesa_file = os.path.join(historic_res_dir, &quot;Blue_Mesa_xre_data.csv&quot;)

# Import baseline dataframe
baseline = pd.read_csv(blue_mesa_file, index_col=False, usecols=[&#39;Year&#39;,&#39;Init. Storage&#39;])
baseline = baseline.groupby(&#39;Year&#39;).mean().reset_index()

# Import SOW1
s0_1_file = os.path.join(scenarios_dir, &quot;S0_1&quot;, &quot;Blue_Mesa_xre_data.csv&quot;)
SOW1 = pd.read_csv(s0_1_file, index_col=False, usecols=[&#39;Year&#39;,&#39;Init. Storage&#39;])
SOW1 = SOW1.groupby(&#39;Year&#39;).mean().reset_index()

# Import SOW2
s1_1_file = os.path.join(scenarios_dir, &quot;S1_1&quot;, &quot;Blue_Mesa_xre_data.csv&quot;)
SOW2 = pd.read_csv(s1_1_file, index_col=False, usecols=[&#39;Year&#39;,&#39;Init. Storage&#39;])
SOW2 = SOW2.groupby(&#39;Year&#39;).mean().reset_index()

# Plot reservoir levels
fig, ax = plt.subplots()

plt.plot(baseline[&#39;Year&#39;], baseline[&#39;Init. Storage&#39;],label=&#39;Baseline&#39;)
plt.plot(SOW1[&#39;Year&#39;], SOW1[&#39;Init. Storage&#39;],label=&#39;Reduced Evaporation&#39;)
plt.plot(SOW2[&#39;Year&#39;], SOW2[&#39;Init. Storage&#39;],label=&#39;Increased Evaporation&#39;)

plt.title(&quot;Blue Mesa Storage&quot;)
plt.xlabel(&quot;Year&quot;)
plt.ylabel(&quot;Reservoir Storage (AF)&quot;)

plt.legend()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7faed3a29fc0</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../_images/output_26_1.png" src="../_images/output_26_1.png" />
<p>We see that in SOW 1 (which corresponds to reduced evaporation), the
Blue Mesa storage is slightly higher than baseline. However, in SOW 2,
which corresponds to increased evaporation, we see that the reservoir
storage has reduced considerably.</p>
<p>We now encourage the user to explore how the changes in reservoir
storage impacts user shortages in Quickstarter Notebook #3.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<p>Hadjimichael, A., Quinn, J., Wilson, E., Reed, P., Basdekas, L., Yates,
D., &amp; Garrison, M. (2020). Defining robustness, vulnerabilities, and
consequential scenarios for diverse stakeholder interests in
institutionally complex river basins. Earth’s Future, 8(7),
e2020EF001503.</p>
<div class="alert alert-block alert-warning docutils container">
<p>Tip: If you are interested in understanding how to apply
<code class="docutils literal notranslate"><span class="pre">statemodify</span></code> functions to your own model, take a look at the
source code found in the repository here:</p>
<div class="docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span>  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/IMMM-SFA/statemodify/blob/main/statemodify/eva.py&quot;</span><span class="o">&gt;</span><span class="n">modify_eva</span><span class="p">()</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-run-a-historical-simulation-in-statemod-for-the-gunnison-subbasin">Step 1: Run a Historical Simulation in StateMod for the Gunnison Subbasin</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-modify-statemod-input-files-for-exploratory-analyses-evaporation-function-example">Step 2: Modify StateMod Input Files for Exploratory Analyses- Evaporation Function Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-read-in-the-new-input-files-and-run-statemod-evaporation-example">Step 3: Read in the New Input Files and Run StateMod : Evaporation Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-visualize-reservoir-levels-in-new-sows">Step 4: Visualize Reservoir Levels in New SOWs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Rohini S. Gupta
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, Battelle Memorial Institute.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>